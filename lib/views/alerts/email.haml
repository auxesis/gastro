- styles = { :body      => 'font-family: sans-serif; padding: 10px;',
             :heading   => 'background-color: #28b62c; color: #eee; padding: 15px 10px; border-color: #24a528; border-bottom-width: 10px;',
             :intro     => 'color: #333; padding: 10px; font-size: 120%;',
             :offence   => 'background-color: #fafafa; color: #111; padding: 10px; margin-bottom: 10px;',
             :title     => 'color: #158cba; text-decoration: none;',
             :th        => 'text-align: left;',
             :edit      => 'color: #111; padding: 10px;',
             :signature => 'padding: 10px;',
             :link      => 'color: #158cba' }
%html
  %body{:style => styles[:body]}
    %h1{:style => styles[:heading]}
      Got Gastro
    %p{:style => styles[:intro]}
      The following
      %strong new food safety warnings
      have been found within
      %em= "#{alert.distance}km"
      of
      %em= alert.address + '.'

    %div
      - offences.each do |offence|
        %div{:style => styles[:offence]}
          %a{:href => offence.link, :style => styles[:title]}
            %h3
              = offence.business.name
              â€“
              = offence.business.address
          %table
            %tr
              %th{:style => styles[:th]}
                Distance away:
              %td
                = "%.2f" % offence.business.distance_from(alert)
                km
            %tr
              %th{:style => styles[:th]}
                When:
              %td
                = offence.date.strftime("%B %d, %Y")
            %tr
              %th{:style => styles[:th]}
                Description:
              %td
                - if offence.description =~ /\n/
                  :markdown
                    #{offence.description}
                - else
                  = offence.description.strip
          %p
            - link = "#{config['settings']['baseurl']}/business/#{offence.business.id}"
            %a{:href => link, :style => styles[:link]}
              See all food safety problems at this address

    %p{:style => styles[:signature]}
      Thanks,
      %br/
      Got Gastro

    %p{:style => styles[:edit]}
      %a{:style => styles[:link], :href => "#{config['settings']['baseurl']}/alert/#{alert.confirmation_id}/unsubscribe"}<
        Unsubscribe
      or
      %a{:style => styles[:link], :href => "#{config['settings']['baseurl']}/alert/#{alert.confirmation_id}/edit"}<
        change
      your alert preferences.
